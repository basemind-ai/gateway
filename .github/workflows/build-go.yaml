name: 'Build'
on:
    push:
        branches:
            - main
    pull_request:
        branches:
            - main
#  workflow_run:
#    branches:
#      - main
#    workflows:
#    - "Tests (Golang)"
#    types:
#      - completed
env:

jobs:
    build:
        runs-on: ubuntu-latest
        #if: github.event_name == 'push' && startsWith(github.ref, 'refs/tags') # run only on tagged commits
        strategy:
            matrix:
                service:
                    - api-gateway
                    - dashboard-backend
        steps:
            - uses: basemind-ai/monorepo/.github/actions/build-and-push-docker-image.yaml@main
              with:
                  DOCKERFILE_PATH: ./docker/Dockerfile.go-services
                  GCP_OIDC_PROVIDER_NAME: github-provider
                  GCP_PROJECT_ID: basemind-ai-development
                  GCP_PROJECT_NUMBER: 78794879644
                  GCP_REGION: europe-west3
                  GCP_SERVICE_ACCOUNT_NAME: github-actions
                  GCP_WORKLOAD_IDENTITY_POOL: dev-pool
                  SERVICE_NAME: ${{ matrix.service }}
                  BUILD_ARGS: |
                      BUILD_TARGET=${{matrix.service}}
